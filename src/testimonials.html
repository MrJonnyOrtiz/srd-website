<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- Google tag (gtag.js) -->
      <script
         async
         src="https://www.googletagmanager.com/gtag/js?id=G-CHEZE0LXQD"
      ></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag() {
            dataLayer.push(arguments);
         }
         gtag("js", new Date());

         gtag("config", "G-CHEZE0LXQD");
      </script>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta
         name="description"
         content="Sarasota Remodeling and Design services are licensed contractors, on-time completion, and quality design and construction that meet your home improvement and renovation needs and exceeds your expectations."
      />
      <link
         rel="icon"
         type="image/png"
         href="
   ./assets/media/SRDfavicon.png"
      />

      <link rel="stylesheet" type="text/css" href="./assets/css/main.scss" />
      <title>Sarasota Remodeling And Design - Testimonials</title>
      <script type="application/ld+json">
         {
            "@context": "http://schema.org",
            "@type": "Product",
            "name": "Sarasota Remodeling & Design",
            "image": "http://srd.cloudrealmllc.com/Image%2010-18-22%20at%206.39%20PM.2e9e3e76.jpeg",
            "description": "We combine our industry knowledge with the highest quality building supplies to deliver exceptional service to our clients.",
            "brand": {
               "@type": "Brand",
               "name": "Sarasota Remodeling & Design",
               "logo": "http://srd.cloudrealmllc.com/SRDlogoWhite.d28983b7.png"
            }
         }
      </script>
      <!-- Google recaptcha -->
      <script
         src="https://www.google.com/recaptcha/api.js"
         async
         defer
      ></script>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   </head>
   <body>
      <div class="container">
         <nav class="navbar navbar-expand-lg">
            <div class="container-fluid d-flex justify-content-center">
               <a class="navbar-brand" href="./index.html"
                  ><img
                     class="logo"
                     src="../src/assets/media/SRDlogoWhite.png"
                     loading="lazy"
                     alt="Sarasota Remodeling and Design Logo"
                  />
                  <span class="h1 align-middle"
                     >Sarasota Remodeling & Design</span
                  ></a
               >
               <button
                  class="navbar-toggler"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#navbarNavAltMarkup"
                  aria-controls="navbarNavAltMarkup"
                  aria-expanded="false"
                  aria-label="Toggle navigation"
               >
                  <span class="navbar-toggler-icon"></span>
               </button>
               <a
                  type="button"
                  class="btn btn-myBlack ms-5 p-2"
                  href="tel:9413130263"
               >
                  GET A FREE QUOTE!
               </a>
               <!--
               <button
                  type="button"
                  class="btn btn-myBlack ms-5 p-2"
                  data-bs-toggle="modal"
                  data-bs-target="#modal"
               >
                  GET A FREE QUOTE!
               </button>
            -->
               <div
                  class="collapse navbar-collapse flex-row justify-content-end"
                  id="navbarNavAltMarkup"
               >
                  <div class="navbar-nav">
                     <li class="nav-item">
                        <a class="nav-link" href="./services.html">Services</a>
                     </li>
                     <li class="nav-item dropdown">
                        <a
                           class="nav-link dropdown-toggle"
                           href="./gallery.html"
                           role="button"
                           data-bs-toggle="dropdown"
                           aria-expanded="false"
                           >Gallery</a
                        >
                        <ul class="dropdown-menu">
                           <li>
                              <a class="dropdown-item" href="./kitchens.html"
                                 >Kitchens</a
                              >
                           </li>
                           <li>
                              <a class="dropdown-item" href="./baths.html"
                                 >Baths</a
                              >
                           </li>
                           <li>
                              <a
                                 class="dropdown-item"
                                 href="./entertainment.html"
                                 >Entertainment Centers</a
                              >
                           </li>
                           <li>
                              <a class="dropdown-item" href="./outdoors.html"
                                 >Outdoors</a
                              >
                           </li>
                           <li>
                              <a class="dropdown-item" href="./flooring.html"
                                 >Flooring</a
                              >
                           </li>
                           <li>
                              <a class="dropdown-item" href="./otherAreas.html"
                                 >Other Areas</a
                              >
                           </li>
                        </ul>
                     </li>
                     <li class="nav-item">
                        <a class="nav-link" href="./testimonials.html"
                           >Testimonials</a
                        >
                     </li>
                     <li class="nav-item">
                        <a class="nav-link" href="./contact.html">Contact</a>
                     </li>
                     <li class="nav-item">
                        <a class="nav-link" href="./blog.html">Blog</a>
                     </li>
                  </div>
               </div>
            </div>
         </nav>

         <!-- Testimonials -->
         <div class="container bg">
            <div class="mx-auto">
               <div class="row">
                  <div class="col">
                     <h2 class="p-2 text-center">Testimonials</h2>
                  </div>
               </div>

               <div class="row text-center">
                  <!-- Reviews bar -->
                  <div class="row">
                     <!-- Select Rating -->
                     <div class="col m-2">
                        <select
                           class="form-select"
                           id="filterRatings"
                           name="filterRatings"
                        >
                           <option value="none" selected>
                              <small text-color="muted">Ratings filter..</small>
                           </option>
                           <option value="5">5 Stars</option>
                           <option value="4">4 Stars</option>
                           <option value="3">3 Stars</option>
                           <option value="2">2 Stars</option>
                           <option value="1">1 Star</option>
                        </select>
                     </div>

                     <!-- Select Service -->
                     <div class="col m-2">
                        <select
                           class="form-select"
                           id="filterService"
                           name="filterService"
                        >
                           <option value="none" selected>
                              <small text-color="muted"
                                 >Remodel area filter..</small
                              >
                           </option>
                           <option value="kitchen">Kitchen</option>
                           <option value="bath">Bath</option>
                           <option value="entertainment">
                              Entertainment center
                           </option>
                           <option value="outdoors">Outdoors</option>
                           <option value="flooring">Flooring</option>
                           <option value="other">Other area</option>
                        </select>
                     </div>

                     <!-- Select Sort -->
                     <div class="col m-2">
                        <select class="form-select" id="sorting" name="sorting">
                           <option value="none" selected>
                              <small text-color="muted">Sort by..</small>
                           </option>
                           <option value="newest">
                              Date: newest to oldest
                           </option>
                           <option value="oldest">
                              Date: oldest to newest
                           </option>
                           <option value="highest">
                              Rank: highest to lowest
                           </option>
                           <option value="lowest">
                              Rank: lowest to highest
                           </option>
                        </select>
                     </div>

                     <!-- New Review Button -->
                     <div class="col m-2">
                        <button
                           type="button"
                           class="btn btn-outline-myWhite"
                           data-bs-toggle="modal"
                           data-bs-target="#ReviewModal"
                        >
                           Enter a review!
                        </button>
                     </div>
                  </div>

                  <!-- Reviews summary -->
                  <div class="row text-center">
                     <div class="col"><div id="queryResult"></div></div>
                  </div>

                  <!-- list of reviews -->
                  <div id="reviewsList"></div>

                  <!-- Review Modal -->
                  <div
                     class="modal fade text-start"
                     id="ReviewModal"
                     tabindex="-1"
                     aria-labelledby="exampleModalLabel"
                     aria-hidden="true"
                  >
                     <div class="modal-dialog">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h1
                                 class="modal-title text-myBlack"
                                 id="exampleModalLabel"
                              >
                                 Compose new review
                              </h1>
                              <button
                                 type="button"
                                 class="btn-close"
                                 data-bs-dismiss="modal"
                                 aria-label="Close"
                              ></button>
                           </div>
                           <div class="modal-body">
                              <div id="userMessage"></div>

                              <!-- Reviews Form -->
                              <form
                                 action="https://x0iujbvnqb.execute-api.us-east-1.amazonaws.com/Prod/"
                                 method="POST"
                                 id="review-form"
                              >
                                 <div class="mb-3">
                                    <label for="fName" class="form-label"
                                       >First Name</label
                                    >
                                    <input
                                       type="text"
                                       class="form-control"
                                       id="fName"
                                       name="fName"
                                       placeholder="First name"
                                       required
                                    />
                                 </div>
                                 <div class="mb-3">
                                    <label for="lInit" class="form-label"
                                       >Last Initial</label
                                    >
                                    <input
                                       type="text"
                                       class="form-control"
                                       id="lInit"
                                       name="lInit"
                                       minlength="1"
                                       maxlength="1"
                                       required
                                    />
                                 </div>
                                 <div class="mb-3">
                                    <label for="stars" class="form-label"
                                       >Rating</label
                                    >
                                    <select
                                       class="form-select"
                                       id="stars"
                                       name="stars"
                                       required
                                    >
                                       <option value="5" selected>
                                          5 Stars
                                       </option>
                                       <option value="4">4 Stars</option>
                                       <option value="3">3 Stars</option>
                                       <option value="2">2 Stars</option>
                                       <option value="1">1 Star</option>
                                    </select>
                                 </div>
                                 <div class="mb-3">
                                    <label for="remodelArea" class="form-label"
                                       >Remodel Area</label
                                    >
                                    <select
                                       class="form-select"
                                       id="remodelArea"
                                       name="remodelArea"
                                       required
                                    >
                                       <option value="kitchen" selected>
                                          Kitchen
                                       </option>
                                       <option value="bath">Bath</option>
                                       <option value="entertainment">
                                          Entertainment center
                                       </option>
                                       <option value="outdoors">
                                          Outdoors
                                       </option>
                                       <option value="flooring">
                                          Flooring
                                       </option>
                                       <option value="other">Other area</option>
                                    </select>
                                 </div>
                                 <div class="mb-3">
                                    <label for="review" class="form-label"
                                       >Your review</label
                                    >
                                    <textarea
                                       class="form-control"
                                       id="review"
                                       name="review"
                                       rows="3"
                                       required
                                    ></textarea>
                                 </div>
                                 <div class="mb-3">
                                    <div
                                       class="g-recaptcha"
                                       data-sitekey="6LcaoNkjAAAAAOFAEh-K5p62Rh3T1V_zzb9lJ1wK"
                                    ></div>
                                 </div>
                                 <div class="m-2">
                                    <button
                                       type="submit"
                                       id="submitBtn"
                                       class="btn btn-primary"
                                    >
                                       Submit
                                    </button>
                                 </div>
                              </form>
                           </div>
                           <div class="modal-footer"></div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div id="theFooter"></div>
      </div>

      <script defer type="module" src="./assets/js/main.js"></script>
      <script defer>
         (function () {
            ("use strict");
            const form_el = document.getElementById("review-form");
            const userMessage_el = document.getElementById("userMessage");
            const reviewsListDiv = document.getElementById("reviewsList");
            const queryResultDiv = document.getElementById("queryResult");
            const filterRatings = document.getElementById("filterRatings");
            const filterService = document.getElementById("filterService");
            const sorting = document.getElementById("sorting");
            let getResult = [];
            let queryResult = 0;
            let currentRating = "none";
            let currentService = "none";
            let currentSort = "none";

            const getStars = (rating) => {
               const starVal = parseInt(rating, 10);
               let output = [];
               for (var i = starVal; i >= 1; i--) output.push("⭐️");
               return output.join("");
            };

            const createReviewElements = (resultArr) => {
               reviewsListDiv.replaceChildren();

               const reviewsArr = resultArr.map((review) => {
                  // create review inner and item, then populate inner with review data
                  const reviewRow = document.createElement("div");
                  reviewRow.classList.add("row", "justify-content-center");
                  const reviewCol = document.createElement("div");
                  reviewCol.classList.add("col-6");
                  const reviewInner = document.createElement("div");
                  reviewInner.classList.add(
                     "card",
                     "text-primary",
                     "mb-4",
                     "visible"
                  );
                  reviewInner.id = review.id;
                  reviewInner.setAttribute("data-stars", `${review.stars}`);
                  reviewInner.setAttribute(
                     "data-remodelarea",
                     `${review.remodelArea}`
                  );
                  const reviewItem = document.createElement("div");
                  reviewItem.classList.add("card-body");
                  const reviewItemHeader = document.createElement("h5");
                  reviewItemHeader.classList.add("card-title", "mb-2");
                  reviewItemHeader.textContent =
                     review.fName +
                     " " +
                     review.lInit +
                     " says this about their " +
                     review.remodelArea +
                     " remodel:";
                  const reviewItemDetail = document.createElement("h6");
                  reviewItemDetail.classList.add("card-text", "fst-italic");
                  reviewItemDetail.textContent = review.review;
                  const reviewItemDetailStars = document.createElement("p");
                  reviewItemDetailStars.textContent =
                     "Rating: " + getStars(review.stars);
                  const reviewItemFooterDiv = document.createElement("div");
                  reviewItemFooterDiv.classList.add("card-footer");
                  const reviewItemFooter = document.createElement("small");

                  let createdDate = new Date(review.timestamp);
                  let createdYear = createdDate.getFullYear();
                  let createdMonth = createdDate.getMonth() + 1;
                  let createdDt = createdDate.getDate();

                  if (createdDt < 10) {
                     createdDt = "0" + createdDt;
                  }
                  if (createdMonth < 10) {
                     createdMonth = "0" + createdMonth;
                  }
                  const sortDate =
                     createdYear.toString() +
                     createdMonth.toString() +
                     createdDt.toString();

                  reviewItemFooter.classList.add("text-muted");
                  reviewItemFooter.textContent =
                     "submitted " +
                     createdMonth +
                     "/" +
                     createdDt +
                     "/" +
                     createdYear;

                  reviewInner.setAttribute("data-sortdate", `${sortDate}`);

                  // add to DOM
                  reviewsListDiv.appendChild(reviewRow);
                  reviewRow.appendChild(reviewCol);
                  reviewCol.appendChild(reviewInner);
                  reviewInner.appendChild(reviewItem);
                  reviewItem.appendChild(reviewItemHeader);
                  reviewItem.appendChild(reviewItemDetail);
                  reviewItem.appendChild(reviewItemDetailStars);
                  reviewItem.appendChild(reviewItemFooterDiv);
                  reviewItemFooterDiv.appendChild(reviewItemFooter);
               });
            };

            const renderNumberOfReviews = (resultArr) => {
               queryResultDiv.replaceChildren();

               // sum of stars
               const sumOfStars = resultArr.reduce((accumulator, current) => {
                  return accumulator + parseInt(current.stars);
               }, 0);

               // render number of reviews and average
               queryResult = resultArr.length;
               const queryResultEl = document.createElement("p");
               queryResultEl.classList.add("lead");
               queryResultEl.textContent =
                  resultArr.length > 1 || resultArr.length === 0
                     ? `${resultArr.length} reviews,  ${(
                          sumOfStars / resultArr.length || 0
                       ).toFixed(1)} average stars`
                     : `${resultArr.length} review,  ${(
                          sumOfStars / resultArr.length || 0
                       ).toFixed(1)} average stars`;
               queryResultDiv.appendChild(queryResultEl);
            };

            // Get reviews
            const getReviews = async () => {
               // get all reviews from db and store in reviewsList
               const getResponse = await fetch(
                  "https://x0iujbvnqb.execute-api.us-east-1.amazonaws.com/Prod/"
               );
               if (getResponse.ok) {
                  getResult = await getResponse.json();

                  createReviewElements(getResult);

                  renderNumberOfReviews(getResult);
               } else {
                  alert("error attempting to get reviews");
               }
            };

            // Filter elements by rating
            const handleRatingsSelectChange = (e) => {
               const filterValue = e.target.value;
               currentRating = filterValue;
               sorting.value = "none";

               // ratings and service are none, re-render all cards
               if (currentService === "none" && filterValue === "none") {
                  createReviewElements(getResult);

                  renderNumberOfReviews(getResult);
               }

               // ratings not none, service none, filter all cards by rating
               else if (currentService === "none" && filterValue !== "none") {
                  // filter all cards
                  const filteredCards = getResult.filter(
                     (card) => card.stars === filterValue
                  );

                  createReviewElements(filteredCards);

                  renderNumberOfReviews(filteredCards);
               }

               // ratings not none, service not none, filter all cards on currentService, then ratings
               else if (currentService !== "none" && filterValue !== "none") {
                  // filter all cards
                  const filteredServiceCards = getResult.filter(
                     (card) => card.remodelArea === currentService
                  );
                  const filteredCards = filteredServiceCards.filter(
                     (card) => card.stars === filterValue
                  );

                  createReviewElements(filteredCards);

                  renderNumberOfReviews(filteredCards);
               }

               // ratings none, service not none, filter all cards on currentService
               else if (currentService !== "none" && filterValue === "none") {
                  // filter all cards
                  const filteredCards = getResult.filter(
                     (card) => card.remodelArea === currentService
                  );

                  createReviewElements(filteredCards);

                  renderNumberOfReviews(filteredCards);
               }
            };

            // Filter elements by service
            const handleServiceSelectChange = (e) => {
               const filterValue = e.target.value;
               currentService = filterValue;
               sorting.value = "none";

               // ratings and service are none, re-render all cards
               if (currentRating === "none" && filterValue === "none") {
                  createReviewElements(getResult);

                  renderNumberOfReviews(getResult);
               }

               // ratings is none, service not none, filter all cards by service
               else if (currentRating === "none" && filterValue !== "none") {
                  // filter all cards
                  const filteredCards = getResult.filter(
                     (card) => card.remodelArea === filterValue
                  );

                  createReviewElements(filteredCards);

                  renderNumberOfReviews(filteredCards);
               }

               // ratings not none, service not none, filter all cards on currentRatings, then service
               else if (currentService !== "none" && filterValue !== "none") {
                  // filter all cards
                  const filteredRatingCards = getResult.filter(
                     (card) => card.stars === currentRating
                  );
                  const filteredCards = filteredRatingCards.filter(
                     (card) => card.remodelArea === filterValue
                  );

                  createReviewElements(filteredCards);

                  renderNumberOfReviews(filteredCards);
               }

               // service none, ratings not none, filter all cards on currentRating
               else if (currentRating !== "none" && filterValue === "none") {
                  // filter all cards
                  const filteredCards = getResult.filter(
                     (card) => card.stars === currentRating
                  );

                  createReviewElements(filteredCards);

                  renderNumberOfReviews(filteredCards);
               }
            };

            // Sort elements by date
            const handleSortChange = (e) => {
               const sortValue = e.target.value;

               // select cards
               const cardsList = document.querySelectorAll(".visible");

               // sort cards
               const sortedReviews = Array.from(cardsList);
               if (sortValue === "newest") {
                  sortedReviews.sort(
                     (a, b) =>
                        parseInt(b.dataset.sortdate) -
                        parseInt(a.dataset.sortdate)
                  );
               } else if (sortValue === "oldest") {
                  sortedReviews.sort(
                     (a, b) =>
                        parseInt(a.dataset.sortdate) -
                        parseInt(b.dataset.sortdate)
                  );
               } else if (sortValue === "highest") {
                  sortedReviews.sort(
                     (a, b) =>
                        parseInt(b.dataset.stars) - parseInt(a.dataset.stars)
                  );
               } else {
                  sortedReviews.sort(
                     (a, b) =>
                        parseInt(a.dataset.stars) - parseInt(b.dataset.stars)
                  );
               }

               // render sorted list
               reviewsListDiv.replaceChildren();

               // add back to the DOM
               sortedReviews.map((review) => {
                  const reviewRow = document.createElement("div");
                  reviewRow.classList.add("row", "justify-content-center");
                  const reviewCol = document.createElement("div");
                  reviewCol.classList.add("col-6");
                  review.classList.remove("invisible");
                  review.classList.add("visible");

                  reviewsListDiv.appendChild(reviewRow);
                  reviewRow.appendChild(reviewCol);
                  reviewCol.appendChild(review);
               });
            };

            // Submit a new review
            form_el.addEventListener("submit", async (e) => {
               e.preventDefault();

               const formDataObj = Object.fromEntries(
                  new FormData(e.target).entries()
               );

               try {
                  let message = "Please enter: ";

                  const nameVal = /[A-Za-z]{1}[A-Za-z]/;

                  if (formDataObj.fName === "") {
                     message += "First Name \n ";
                  } else {
                     if (!nameVal.test(formDataObj.fName)) {
                        message += `Please enter more than 2 characters for your First Name.
                         `;
                     }
                  }

                  if (formDataObj.lInit === "") {
                     message += "Last Initial \n ";
                  }

                  if (formDataObj.review === "") {
                     message += "Your review";
                  }

                  if (message.length > 14) {
                     userMessage_el.classList.add("alert", "alert-danger");
                     userMessage_el.setAttribute("role", "alert");
                     userMessage_el.textContent = message + ".";
                  } else {
                     userMessage_el.textContent = "";
                     userMessage_el.classList.remove("alert", "alert-danger");
                     form_el.reset();
                     message = "Thank you for your review!";
                     alert(message);
                     message = "";
                     $("#ReviewModal").modal("hide");

                     // POST review
                     const raw = JSON.stringify(formDataObj);

                     const requestOptions = {
                        method: "POST",
                        body: raw,
                     };

                     const response = await fetch(
                        "https://x0iujbvnqb.execute-api.us-east-1.amazonaws.com/Prod/",
                        requestOptions
                     );

                     const result = await response.json();
                     if (response.ok) {
                        console.log("review saved:", result.message);
                        location.reload();
                     } else {
                        throw new Error(
                           `Failed to post review: status code ${response.status} ${result.message}`
                        );
                     }
                  }
               } catch (err) {
                  console.log(err.message);
               }
            });

            filterRatings.addEventListener("change", handleRatingsSelectChange);
            filterService.addEventListener("change", handleServiceSelectChange);
            sorting.addEventListener("change", handleSortChange);

            getReviews();
         })();
      </script>
   </body>
</html>
